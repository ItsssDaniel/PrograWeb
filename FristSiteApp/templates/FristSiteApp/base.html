{% load static %}
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="es" lang="es">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-t" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>SGCM MEDIC - Sistema de GestiÃ³n de Citas MÃ©dicas</title>
    
    <link rel="stylesheet" href="{% static 'FristSiteApp/css/style.css' %}" type="text/css" />
    <link rel="stylesheet" href="{% static 'FristSiteApp/css/views.css' %}" type="text/css" /> 
    
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    
</head>
<body 
    x-data="{ 
        darkMode: localStorage.getItem('modoOscuro') === 'activado',
        toggleDarkMode() {
            this.darkMode = !this.darkMode;
            localStorage.setItem('modoOscuro', this.darkMode ? 'activado' : 'desactivado');
            if (this.darkMode) {
                document.documentElement.setAttribute('data-tema', 'oscuro');
            } else {
                document.documentElement.removeAttribute('data-tema');
            }
        }
    }" 
    x-init="if (darkMode) document.documentElement.setAttribute('data-tema', 'oscuro')">

    <div id="header">
        <div class="container header-content">
            <div class="logo">
                <h1>SGCM MEDIC</h1>
            </div>
            <div class="header-controls">
                <div class="nav">
                    <ul>
                        <li><a href="{% url 'home' %}">Inicio</a></li>
                        <li><a href="{% url 'citas' %}">Citas</a></li>
                        <li><a href="{% url 'registro' %}">Registro</a></li>
                        <li><a href="{% url 'contacto' %}">Contacto</a></li>
                    </ul>
                </div>
                <button id="btn-login" class="btn-login" title="Iniciar SesiÃ³n" type="button">
                    <span class="icono-login">ðŸ”‘</span>
                </button>
            </div>
        </div>
    </div>

    {% block content %}
    {% endblock %}

    <div id="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-controls">
                    <div class="footer-left">
                        <button 
                            id="btn-modo-oscuro" 
                            class="btn-modo-oscuro" 
                            title="Modo Oscuro" 
                            type="button" 
                            @click="toggleDarkMode()">
                            <span class="icono-modo" x-text="darkMode ? 'â˜€ï¸' : 'ðŸŒ™'"></span>
                        </button>
                    </div>
                    
                    <div class="footer-center">
                        <div class="validadores-w3c">
                            <a href="https://validator.w3.org/#validate_by_upload" 
                               rel="noopener noreferrer" 
                               title="Validar XHTML con W3C"
                               class="validador-link">
                                <img src="https://www.w3.org/Icons/valid-xhtml10" 
                                     alt="XHTML VÃ¡lido" 
                                     class="validador-img" />
                                XHTML
                            </a>
                            <a href="https://jigsaw.w3.org/css-validator/#validate_by_upload" 
                               rel="noopener noreferrer" 
                               title="Validar CSS con W3C"
                               class="validador-link">
                                <img src="https://jigsaw.w3.org/css-validator/images/vcss-blue" 
                                     alt="CSS VÃ¡lido" 
                                     class="validador-img" />
                                CSS3
                            </a>
                        </div>
                    </div>
                    
                    <div class="footer-right">
                        <div 
                            id="dbStatus" 
                            x-data="{ 
                                message: 'Verificando conexiÃ³n...', 
                                statusClass: 'db-status' 
                            }"
                            x-init="
                                fetch('/dataBaseConexion/')
                                    .then(response => response.json())
                                    .then(data => {
                                        if (data.conectado) {
                                            statusClass = 'db-status conectado';
                                            message = '<span class=\'status-icon\'></span> âœ… Base de Datos Conectada';
                                        } else {
                                            statusClass = 'db-status error';
                                            message = '<span class=\'status-icon\'></span> âŒ Error de ConexiÃ³n';
                                        }
                                    })
                                    .catch(error => {
                                        statusClass = 'db-status error';
                                        message = '<span class=\'status-icon\'></span> âŒ Error de ConexiÃ³n';
                                        console.error('Error verificando BD:', error);
                                    })
                            "
                            :class="statusClass"
                            x-html="message">
                            </div>
                    </div>
                </div>
                
                <div class="copyright">
                    &copy; 2024 SGCM MEDIC. Todos los derechos reservados.
                </div>
            </div>
        </div>
    </div>

    <script type="text/javascript">
        //<![CDATA[
        function abrirLogin() {
            window.location.href = "{% url 'login' %}";
        }
        document.getElementById('btn-login').addEventListener('click', abrirLogin);
        var anchors = document.querySelectorAll('a[href^="#"]');
        for (var i = 0; i < anchors.length; i++) {
            anchors[i].addEventListener('click', function (e) {
                e.preventDefault();
                var target = document.querySelector(this.getAttribute('href'));
                if (target) {
                    target.scrollIntoView({
                        behavior: 'smooth',
                        block: 'start'
                    });
                }
            });
        }
        
        // Â¡Ya no necesitamos el DOMContentLoaded para la BD! Alpine lo maneja.
        //]]>
    </script>
</body>
</html>